var gpio = require('pi-gpio');

var relays = [
  { name: "lights 1", pin: 22 },
  { name: "lights 2", pin: 11 },
  { name: "CO2",      pin: 13 },
  { name: "unused 4", pin: 15 },
  { name: "unused 5", pin: 16 },
  { name: "unused 6", pin: 18 }
];

function noop(){}

function findRelay(pin)
{
  for (var i in relays) {
    if (relays[i].pin == pin) {
      return relays[i]  ;
    }
  }
  throw 'Invalid pin: ' + pin;;
}

var relay = {
  init: function () {
    for (var i in relays) {
      gpio.open(relays[i].pin, "output");
    }
  },

  list: function () {
    return relays;
  },

  set: function (pin, state, callback) {
    var relay = findRelay(pin);

    gpio.write(pin, state ? 1 : 0, function () {
      relay.on = state;
      (callback || noop)();
    });
  }
};

module.exports = relay;